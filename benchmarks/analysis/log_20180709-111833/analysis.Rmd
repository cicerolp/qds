---
title: "R Notebook"
output: html_notebook
---

```{r include=FALSE}
library("lhs")
library("scales")
library("tidyverse")
library("RColorBrewer")
```

```{r}
load <- function(dataset) {
  file <- Sys.glob(paste0("disabled_*", dataset, "*"))
  
  df <- read_delim(file, delim = ";", col_names = FALSE)
  
  df %>% group_by(X3, X5) %>%
    summarise(
        Time = sum(X7)
    ) %>% 
    group_by(X3) %>%
    summarise(
      Max = max(Time),
      Min = min(Time),
      Mean = mean(Time),
      Stdv = sd(Time)
    ) %>% 
    mutate (
      Dataset = dataset,
      Structure = "QDS"
    ) %>% 
    filter(Mean < 80)
}
```

```{r}
load_hc <- function(dataset) {
  file <- Sys.glob(paste0("*", dataset, "-hc*"))
  
  df <- read_delim(file, delim = ",", col_names = FALSE)
  
  df %>% 
    mutate(
      Max = X1,
      Min = X1,
      Mean = X1,
      Stdv = 0,
      Dataset = dataset,
      Structure = "Hashedcubes"
    ) %>% select(-(X1:X6)) %>%
    mutate(X3 = row_number() - 1)
}
```

```{r include=FALSE}
data <- rbind(
  load("brightkite"), load("gowalla"), load("flights"), load("twitter-small"),
  load_hc("brightkite"), load_hc("gowalla"), load_hc("flights"), load_hc("twitter-small")
)
```

```{r fig.height=4.4, fig.width=6}
data %>% 
  # filter(Dataset == "brightkite") %>%
  filter(Mean >= 1) %>%
  ggplot(aes(x = Structure, y = Mean)) + 
    # geom_jitter(aes(colour = Structure), position = position_jitter(width = .05), alpha = 0.5) +
    geom_boxplot(aes(colour = Structure), outlier.alpha = 1.0) + 
    coord_flip() + 
    labs(title = "Performance Comparison of Couting Queries") +
    # labs(title = "") +
    ylab("Running Time (ms)") +
    xlab("") +
    # guides(colour = FALSE) + 
    theme_bw() +
    theme(
      plot.title = element_text(hjust = 0.5, size = 11),
      axis.title.x = element_text(size = 10),
      axis.title.y = element_text(size = 10),
      legend.justification = "center",
      legend.direction = "horizontal",
      # legend.text = element_text(angle = 90, hjust = 1),
      # legend.position = c(0.5, 0.98),
      legend.position = "top",
      # legend.title = element_text(size = 11),
      legend.title = element_blank(),
      legend.margin = margin(t = -0.1, b = -0.2, unit='cm'),
      plot.margin = unit(c(0.1,1,0,0), "lines"),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      strip.text.y = element_text(size = 8)
    ) +
    scale_colour_manual(values = brewer.pal(3, "Set1")) +
    scale_y_continuous(breaks = scales::pretty_breaks(n = 15)) +
    # scale_y_continuous(breaks = round(seq(0, 10000, by = 200), 2)) +
    facet_wrap(. ~  Dataset, ncol = 1, scales = "free_x", strip.position="right")
    # scale_x_discrete(labels= c("p-digest", "Naive"))

ggsave("query_performance.pdf")
```


